{% extends 'baseFront.html.twig' %}

{% block title %}Club Index{% endblock %}

{% block body %}
<div class="container mt-5 pt-5">
    <div class="card p-4 shadow-lg mx-auto" style="max-width: 1000px;">
        <h1 class="text-center mb-4">üìå Popular Courses</h1>

        <!-- Barre de recherche -->
        <div class="mb-4 text-center">
            <input type="text" id="searchCourse" class="form-control shadow-sm" placeholder="Rechercher un cours..." style="width: 300px; margin: auto;">
        </div>

       

        <!-- Tableau des cours -->
        <table class="table table-hover table-bordered text-center">
            <thead class="thead-dark">
                <tr class="table-primary">
                    <th>Nom</th>
                    <th>Description</th>
                    <th>Dur√©e</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="courseTableBody">
                {% for cour in cours %}
                    <tr>
                        <td>{{ cour.nom }}</td>
                        <td>{{ cour.description }}</td>
                        <td>{{ cour.duree }}</td>
                        <td>
                            <div class="text-center mt-3">
                                <button class="btn btn-primary" onclick="showSessions('{{ cour.id }}')">D√©tails</button>
                            </div>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="4" class="text-center">Aucun cours disponible.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Popup personnalis√© pour afficher les s√©ances -->
        <div id="popupSeances" class="popup">
            <div class="popup-content">
                <span class="close-btn" onclick="closePopup()">&times;</span>
                <h5>Liste des S√©ances</h5>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Date</th>
                            <th>Professeur</th>
                        </tr>
                    </thead>
                    <tbody id="popupModalSeances">
                        <!-- Contenu des s√©ances charg√© dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Style pour le Popup -->
<style>
    .popup {
        display: none; /* Cach√© par d√©faut */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    .popup-content {
        background: white;
        padding: 20px;
        border-radius: 5px;
        width: 80%;
        max-width: 800px;
        overflow-y: auto;
    }

    .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        cursor: pointer;
    }
</style>

<script>
    // Filtrer les cours en fonction de la recherche
    document.getElementById('searchCourse').addEventListener('keyup', function () {
        let query = this.value.toLowerCase();
        let rows = document.querySelectorAll("#courseTableBody tr");

        rows.forEach(row => {
            let courseName = row.querySelector("td:nth-child(1)").textContent.toLowerCase();
            row.style.display = (courseName.startsWith(query)) ? "" : "none";
        });
    });

    // Fonction pour ouvrir le popup
    function showSessions(courId) {
        fetch(`/seances/cours/${courId}`)
            .then(response => response.json())
            .then(seances => {
                let tbody = document.getElementById('popupModalSeances');
                tbody.innerHTML = ''; // Nettoyer le tableau avant d'ajouter du contenu

                if (seances.length > 0) {
                    seances.forEach(seance => {
                        let row = `
                            <tr>
                                <td>${seance.id}</td>
                                <td>${seance.date}</td>
                                <td>${seance.professeur}</td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="3" class="text-center">Aucune s√©ance disponible pour ce cours.</td></tr>';
                }

                // Afficher le popup
                document.getElementById('popupSeances').style.display = 'flex';
            })
            .catch(error => {
                console.error('Erreur lors du chargement des s√©ances:', error);
                alert('Une erreur s\'est produite lors du chargement des s√©ances pour le cours ID: ' + courId);
            });
    }

    // Fonction pour fermer le popup
    function closePopup() {
        document.getElementById('popupSeances').style.display = 'none';
    }
</script>
{% endblock %}
